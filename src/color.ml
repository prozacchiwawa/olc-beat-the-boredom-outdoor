type color = { r : int ; b : int ; g : int ; a : float }

let palette =
  [|
    (* First Row *)
    { r = 0x00 ; g = 0x00 ; b = 0x00 ; a = 1.0 }
  ; { r = 0x40 ; g = 0x40 ; b = 0x40 ; a = 1.0 }
  ; { r = 0x6c ; g = 0x6c ; b = 0x6c ; a = 1.0 }
  ; { r = 0x90 ; g = 0x90 ; b = 0x90 ; a = 1.0 }
  ; { r = 0xb0 ; g = 0xb0 ; b = 0xb0 ; a = 1.0 }
  ; { r = 0xc8 ; g = 0xc8 ; b = 0xc8 ; a = 1.0 }
  ; { r = 0xdc ; g = 0xdc ; b = 0xdc ; a = 1.0 }
  ; { r = 0xec ; g = 0xec ; b = 0xec ; a = 1.0 }
    (* Second Row *)
  ; { r = 0x44 ; g = 0x44 ; b = 0x00 ; a = 1.0 }
  ; { r = 0x64 ; g = 0x64 ; b = 0x10 ; a = 1.0 }
  ; { r = 0x84 ; g = 0x84 ; b = 0x24 ; a = 1.0 }
  ; { r = 0xa0 ; g = 0xa0 ; b = 0x34 ; a = 1.0 }
  ; { r = 0xb8 ; g = 0xb8 ; b = 0x40 ; a = 1.0 }
  ; { r = 0xd0 ; g = 0xd0 ; b = 0x50 ; a = 1.0 }
  ; { r = 0xe8 ; g = 0xe8 ; b = 0x5c ; a = 1.0 }
  ; { r = 0xfc ; g = 0xfc ; b = 0x68 ; a = 1.0 }
  (* Third Row *)
  ; { r = 0x70 ; g = 0x28 ; b = 0x00 ; a = 1.0 }
  ; { r = 0x84 ; g = 0x44 ; b = 0x14 ; a = 1.0 }
  ; { r = 0x98 ; g = 0x5c ; b = 0x28 ; a = 1.0 }
  ; { r = 0xac ; g = 0x78 ; b = 0x3c ; a = 1.0 }
  ; { r = 0xbc ; g = 0x8c ; b = 0x4c ; a = 1.0 }
  ; { r = 0xcc ; g = 0xa0 ; b = 0x5c ; a = 1.0 }
  ; { r = 0xdc ; g = 0xb4 ; b = 0x68 ; a = 1.0 }
  ; { r = 0xec ; g = 0xc8 ; b = 0x78 ; a = 1.0 }
  (* Fourth Row *)
  ; { r = 0x88 ; g = 0x00 ; b = 0x00 ; a = 1.0 }
  ; { r = 0x9c ; g = 0x20 ; b = 0x20 ; a = 1.0 }
  ; { r = 0xb0 ; g = 0x3c ; b = 0x3c ; a = 1.0 }
  ; { r = 0xc0 ; g = 0x58 ; b = 0x58 ; a = 1.0 }
  ; { r = 0xd0 ; g = 0x70 ; b = 0x70 ; a = 1.0 }
  ; { r = 0xe0 ; g = 0x88 ; b = 0x88 ; a = 1.0 }
  ; { r = 0xec ; g = 0xa0 ; b = 0xa0 ; a = 1.0 }
  ; { r = 0xfc ; g = 0xb4 ; b = 0xb4 ; a = 1.0 }
  (* Fifth Row *)
  ; { r = 0x78 ; g = 0x00 ; b = 0x5c ; a = 1.0 }
  ; { r = 0x8c ; g = 0x20 ; b = 0x74 ; a = 1.0 }
  ; { r = 0xa0 ; g = 0x3c ; b = 0x88 ; a = 1.0 }
  ; { r = 0xb0 ; g = 0x58 ; b = 0x9c ; a = 1.0 }
  ; { r = 0xc0 ; g = 0x70 ; b = 0xb0 ; a = 1.0 }
  ; { r = 0xd0 ; g = 0x84 ; b = 0xc0 ; a = 1.0 }
  ; { r = 0xdc ; g = 0x8c ; b = 0xd0 ; a = 1.0 }
  ; { r = 0xec ; g = 0xb0 ; b = 0xe0 ; a = 1.0 }
  (* Sixth Row *)
  ; { r = 0x48 ; g = 0x00 ; b = 0x78 ; a = 1.0 }
  ; { r = 0x60 ; g = 0x20 ; b = 0x90 ; a = 1.0 }
  ; { r = 0x78 ; g = 0x3c ; b = 0xa4 ; a = 1.0 }
  ; { r = 0x8c ; g = 0x58 ; b = 0xb8 ; a = 1.0 }
  ; { r = 0xa0 ; g = 0x70 ; b = 0xcc ; a = 1.0 }
  ; { r = 0xb4 ; g = 0x84 ; b = 0xdc ; a = 1.0 }
  ; { r = 0xc4 ; g = 0x9c ; b = 0xec ; a = 1.0 }
  ; { r = 0xd4 ; g = 0xb0 ; b = 0xfc ; a = 1.0 }
  (* Seventh Row *)
  ; { r = 0x14 ; g = 0x00 ; b = 0x84 ; a = 1.0 }
  ; { r = 0x30 ; g = 0x20 ; b = 0x98 ; a = 1.0 }
  ; { r = 0x4c ; g = 0x3c ; b = 0xac ; a = 1.0 }
  ; { r = 0x68 ; g = 0x58 ; b = 0xc0 ; a = 1.0 }
  ; { r = 0x7c ; g = 0x70 ; b = 0xd0 ; a = 1.0 }
  ; { r = 0x94 ; g = 0x88 ; b = 0xe0 ; a = 1.0 }
  ; { r = 0xa8 ; g = 0xa0 ; b = 0xec ; a = 1.0 }
  ; { r = 0xbc ; g = 0xb4 ; b = 0xfc ; a = 1.0 }
  (* Eighth Row *)
  ; { r = 0x00 ; g = 0x00 ; b = 0x88 ; a = 1.0 }
  ; { r = 0x1c ; g = 0x20 ; b = 0x9c ; a = 1.0 }
  ; { r = 0x38 ; g = 0x40 ; b = 0xb0 ; a = 1.0 }
  ; { r = 0x50 ; g = 0x5c ; b = 0xc0 ; a = 1.0 }
  ; { r = 0x68 ; g = 0x74 ; b = 0xd0 ; a = 1.0 }
  ; { r = 0x7c ; g = 0x8c ; b = 0xe0 ; a = 1.0 }
  ; { r = 0x90 ; g = 0xa4 ; b = 0xec ; a = 1.0 }
  ; { r = 0xa4 ; g = 0xb8 ; b = 0xfc ; a = 1.0 }
  (* Ninth Row *)
  ; { r = 0x00 ; g = 0x18 ; b = 0x7c ; a = 1.0 }
  ; { r = 0x1c ; g = 0x38 ; b = 0x90 ; a = 1.0 }
  ; { r = 0x38 ; g = 0x54 ; b = 0xa8 ; a = 1.0 }
  ; { r = 0x50 ; g = 0x70 ; b = 0xbc ; a = 1.0 }
  ; { r = 0x68 ; g = 0x88 ; b = 0xcc ; a = 1.0 }
  ; { r = 0x7c ; g = 0x9c ; b = 0xdc ; a = 1.0 }
  ; { r = 0x90 ; g = 0xb4 ; b = 0xec ; a = 1.0 }
  ; { r = 0xa4 ; g = 0xc8 ; b = 0xfc ; a = 1.0 }
  (* Tenth Row *)
  ; { r = 0x00 ; g = 0x2c ; b = 0x5c ; a = 1.0 }
  ; { r = 0x1c ; g = 0x4c ; b = 0x78 ; a = 1.0 }
  ; { r = 0x38 ; g = 0x68 ; b = 0x90 ; a = 1.0 }
  ; { r = 0x50 ; g = 0x84 ; b = 0xac ; a = 1.0 }
  ; { r = 0x68 ; g = 0x9c ; b = 0xc0 ; a = 1.0 }
  ; { r = 0x7c ; g = 0xb4 ; b = 0xd4 ; a = 1.0 }
  ; { r = 0x90 ; g = 0xcc ; b = 0xe8 ; a = 1.0 }
  ; { r = 0xa4 ; g = 0xe0 ; b = 0xfc ; a = 1.0 }
  (* Eleventh Row *)
  ; { r = 0x00 ; g = 0x3c ; b = 0x2c ; a = 1.0 }
  ; { r = 0x1c ; g = 0x5c ; b = 0x48 ; a = 1.0 }
  ; { r = 0x38 ; g = 0x7c ; b = 0x64 ; a = 1.0 }
  ; { r = 0x50 ; g = 0x9c ; b = 0x80 ; a = 1.0 }
  ; { r = 0x68 ; g = 0xb4 ; b = 0x94 ; a = 1.0 }
  ; { r = 0x7c ; g = 0xd0 ; b = 0xac ; a = 1.0 }
  ; { r = 0x90 ; g = 0xe4 ; b = 0xc0 ; a = 1.0 }
  ; { r = 0xa4 ; g = 0xfc ; b = 0xd4 ; a = 1.0 }
  (* Twelfth Row *)
  ; { r = 0x00 ; g = 0x3c ; b = 0x00 ; a = 1.0 }
  ; { r = 0x20 ; g = 0x5c ; b = 0x20 ; a = 1.0 }
  ; { r = 0x40 ; g = 0x7c ; b = 0x40 ; a = 1.0 }
  ; { r = 0x5c ; g = 0x9c ; b = 0x5c ; a = 1.0 }
  ; { r = 0x74 ; g = 0xb4 ; b = 0x74 ; a = 1.0 }
  ; { r = 0x8c ; g = 0xd0 ; b = 0x8c ; a = 1.0 }
  ; { r = 0xa4 ; g = 0xe4 ; b = 0xa4 ; a = 1.0 }
  ; { r = 0xb8 ; g = 0xfc ; b = 0xb8 ; a = 1.0 }
  (* Thirteenth Row *)
  ; { r = 0x14 ; g = 0x38 ; b = 0x00 ; a = 1.0 }
  ; { r = 0x34 ; g = 0x5c ; b = 0x1c ; a = 1.0 }
  ; { r = 0x50 ; g = 0x7c ; b = 0x38 ; a = 1.0 }
  ; { r = 0x6c ; g = 0x98 ; b = 0x50 ; a = 1.0 }
  ; { r = 0x84 ; g = 0xb4 ; b = 0x68 ; a = 1.0 }
  ; { r = 0x9c ; g = 0xcc ; b = 0x7c ; a = 1.0 }
  ; { r = 0xb4 ; g = 0xe4 ; b = 0x90 ; a = 1.0 }
  ; { r = 0xc8 ; g = 0xfc ; b = 0xa4 ; a = 1.0 }
    (* Fourteenth Row *)
  ; { r = 0x2c ; g = 0x30 ; b = 0x00 ; a = 1.0 }
  ; { r = 0x4c ; g = 0x50 ; b = 0x1c ; a = 1.0 }
  ; { r = 0x68 ; g = 0x70 ; b = 0x34 ; a = 1.0 }
  ; { r = 0x84 ; g = 0x8c ; b = 0x4c ; a = 1.0 }
  ; { r = 0x9c ; g = 0xa8 ; b = 0x64 ; a = 1.0 }
  ; { r = 0xb4 ; g = 0xc0 ; b = 0x78 ; a = 1.0 }
  ; { r = 0xcc ; g = 0xd4 ; b = 0x88 ; a = 1.0 }
  ; { r = 0xe0 ; g = 0xec ; b = 0x9c ; a = 1.0 }
  (* Fifteenth Row *)
  ; { r = 0x44 ; g = 0x28 ; b = 0x00 ; a = 1.0 }
  ; { r = 0x64 ; g = 0x48 ; b = 0x18 ; a = 1.0 }
  ; { r = 0x84 ; g = 0x68 ; b = 0x30 ; a = 1.0 }
  ; { r = 0xa0 ; g = 0x84 ; b = 0x44 ; a = 1.0 }
  ; { r = 0xb8 ; g = 0x9c ; b = 0x58 ; a = 1.0 }
  ; { r = 0xd0 ; g = 0xb4 ; b = 0x6c ; a = 1.0 }
  ; { r = 0xe8 ; g = 0xcc ; b = 0x7c ; a = 1.0 }
  ; { r = 0xfc ; g = 0xe0 ; b = 0x8c ; a = 1.0 }
  |]

let colorOfCoord (y,x) = Array.get palette (y * 8 + x)

let stringOfColor color =
  Printf.sprintf "rgba(%d,%d,%d,%f)" color.r color.g color.b color.a

let colorFromPalette palette level =
  let colorChoice =
    min
      ((Array.length palette) - 1)
      (int_of_float (Math.floor (level *. (float_of_int (Array.length palette)))))
  in
  Array.get palette colorChoice

